
<html>

<head>
<script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
</head>

<style>
#container {
    margin: 0px auto;
    width: 640px;
    height: 480px;
    border: 10px #aaa solid;
}
#webCam {
    width: 640px;
    height: 480px;
    background-color: #666;
}
</style>

<script>
    
   //this is needed server side this should run in a node server then
   //client nodes use socket to run the save passing img data and filename
   
// //todo  xxxxxxxxxxxxxxxxxxxxxxxx zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz

// function saveImage(img,fname) {
  
// var fs = require('fs');

// // string generated by canvas.toDataURL()

// // var img = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0"
// // + "NAAAAKElEQVQ4jWNgYGD4Twzu6FhFFGYYNXDUwGFpIAk2E4dHDRw1cDgaCAASFOffhEIO"
// // + "3gAAAABJRU5ErkJggg==";

// // strip off the data: url prefix to get just the base64-encoded bytes

// var data = img.replace(/^data:image\/\w+;base64,/, "");
// var buf = new Buffer(data, 'base64');
// fs.writeFile(fname, buf);
  
// }

// saveImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0"
// + "NAAAAKElEQVQ4jWNgYGD4Twzu6FhFFGYYNXDUwGFpIAk2E4dHDRw1cDgaCAASFOffhEIO"
// + "3gAAAABJRU5ErkJggg==","test2.png");

// // todo: zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz

    
</script>

<body>
    
    <canvas hidden id="canvas"></canvas>
    <div id="container">
        <video autoplay="true" id="videoElement">
        </video>
    </div>
    <br />
    <img id="test" src="" />
    
</body>

<script>


/*global $*/
$( document ).ready(function() {
    console.log( "ready!" );

});

var myVar;

function myFunction() {
    myVar = setInterval(alertFunc, 1000);
}

function alertFunc() {
snapImage();
}

myFunction();

var image = new Image();

var canvas = document.querySelector('#canvas');
var ctx = canvas.getContext('2d');

function snapImage() {
    ctx.drawImage(video,0,0,100,100);
    image = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream"); // here is the most important part because if you dont replace you will get a DOM 18 exception.
    document.querySelector('#test').src = image;
    canvas.toDataURL('image/png', '');
    
    console.log(image);
}

var video = document.querySelector("#videoElement");
navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
if (navigator.getUserMedia) {
    navigator.getUserMedia({video: true}, handleVideo, videoError);
}
function handleVideo(stream) {
    video.src = window.URL.createObjectURL(stream);
    document.querySelector("#test").src=video.src;
}
function videoError(e) {
    document.write("can't use the webcam");
}

</script>

</html>

